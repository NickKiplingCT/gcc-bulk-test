{"icon":"other","settings":{"router":{"mode":"single","animation":"off"},"theme":"default","push-notifications":{"android":{"enabled":false},"ios":{"enabled":false},"wp":{"enabled":false}},"auth":false},"name":"BulkUplift","version":"1.1","pages":[{"start":true,"name":"Splash","config":[{"name":"On-Load Event","type":"event","item-type":"onload","actions":[{"event":"onload","type":"inline-function","data":{"code":"setTimeout(function() {\n  window.plugins.zumo.logout(function() { console.log('Logout success') }, function(r) { console.log('Logout fail') });\n}, 1000);"},"_auto_id_":"146c801c-936b-42ba-95bd-b1c11e28cc10"}]}],"content":[{"name":"staticSplash","type":"area","item-type":"static","content":[{"name":"imgLogo","type":"media","item-type":"image","actions":[],"expressions":{},"fileName":"Glasgow-City-Council-logo-small-3.png"},{"name":"htmlContainer","type":"content","item-type":"html","content":"<h2>Bulk<br>Uplift</h2>","expressions":{}},{"name":"btnStart","type":"control","item-type":"button","content":"Start","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"code":"window.commsManager = new CommsManager();\n\nmdm.store.data__.completedJobs = [];\ndelete mdm.store.data__.currentJob;\n\nvar loader = document.getElementsByTagName('activity-loader')[0];\nloader.show();"},"_auto_id_":"7fdc11d6-e30a-4fae-bd58-f862c3d1814b"},{"event":"click","type":"call-azure-app-service","data":{"name":"bulkUpliftAzure","operation":"getNeighbourhoodDropdown"},"_auto_id_":"003d836e-6e3f-488e-a52c-7397815226a0","actions":[{"event":"fail","type":"inline-function","data":{"code":"var loader = document.getElementsByTagName('activity-loader')[0];\nloader.hide();"},"_auto_id_":"bcd867d9-a461-4baf-8324-93022136f016"},{"event":"success","type":"inline-function","data":{"code":"mdm.store.data__.lastLogin = new Date();"},"_auto_id_":"a9bd6131-9eb8-4366-8862-9fff5c78ee03"},{"event":"success","type":"go-to-page","data":"PatchSelect","_auto_id_":"b166cc85-8de4-460e-86c0-d9ee10ed23df"}]}],"expressions":{}}],"expressions":{}},{"name":"staticDescription","type":"area","item-type":"static","content":[{"name":"htmlDescription","type":"content","item-type":"html","content":"<p>Helping manage your daily bulk uplift tasks with image capture and feedback.</p>\n\n<p class=\"version\">0.0.15</p>","expressions":{}},{"name":"ActivityLoader_1","type":"component","item-type":"web-component-es2015","template":"<activity-loader></activity-loader>","content":[],"component":"ActivityLoader","attributes":{},"actions":[]}],"expressions":{}}]},{"name":"JobList","config":[{"name":"On-Load Event","type":"event","item-type":"onload","actions":[{"name":"inline_function_1","event":"onload","type":"inline-function","data":{"code":"setTimeout(function() {\n  if(mdm.store.data__.azureAppServices.bulkUpliftAzure.getJobs.length == 0 && mdm.store.data__.currentJob === undefined) {\n    var popup = document.getElementById('allComplete');\n    popup.togglePopup();\n  }\n}, 200);"}}]}],"content":[{"name":"titleJobsList","type":"navigation","item-type":"title-bar","content":[{"name":"btnMenu","type":"control","item-type":"button","content":"","theme":"default","right-icon":"fa-bars","expressions":{},"actions":[{"name":"call_function_1","event":"click","type":"call-function","data":{"name":"openContextMenu"}}]}],"extends":{"type":"area","item-type":"row"},"expressions":{}},{"name":"staticJobsOverview","type":"area","item-type":"static","content":[{"name":"htmlOverview","type":"content","item-type":"html","content":"<h2>Current Batch for {{'data__.currentPatch' | store}}</h2>\n\n<div class=\"box\" md-actions='[{\"name\":\"go_to_page_1\",\"event\":\"click\",\"type\":\"go-to-page\",\"data\":\"CompletedJobs\"}]'>\n  <h3><span>{{'data__.completedJobs.length' | store}}</span><br>Completed</h3>\n</div>\n\n<div class=\"box\">\n  <h3><span>{{'data__.currentJob !== undefined ? data__.azureAppServices.bulkUpliftAzure.getJobs.length + 1 : data__.azureAppServices.bulkUpliftAzure.getJobs.length' | store}}</span><br>Remaining</h3>\n</div>\n\n<!--<div class=\"box btn\" md-actions='[{\"name\":\"go_to_page_1\",\"event\":\"click\",\"type\":\"go-to-page\",\"data\":\"RequestJobs\"}]'>\n  <h3>Request Additional Jobs</h3>\n</div>-->","expressions":{}}],"expressions":{}},{"name":"scrollableLaterToday","type":"area","item-type":"scrollable","content":[{"name":"htmlCurrentJob","type":"content","item-type":"html","content":"<h2>Current Job</h2> \n\n<div class=\"jobRow borderTop\"> \n  <div class=\"jobCell address\">\n    <p class=\"name\">{{'data__.currentJob.CustomerName' | store}}</p>\n    <p>{{'data__.currentJob.SingleLineAddress' | store}}</p>\n    <p class=\"contact\">{{'data__.currentJob.Phone' | store}}<p>\n  </div>\n  \n  <div class=\"jobCell btn\" md-actions='[{\"name\":\"go_to_page_1\",\"event\":\"click\",\"type\":\"go-to-page\",\"data\":\"JobDetail\"}]'>\n    <p></p>\n  </div>\n</div>","expressions":{"show":"data__.currentJob"}},{"name":"htmlLaterToday","type":"content","item-type":"html","content":"<h2>Your Jobs</h2>","expressions":{"show":"data__.azureAppServices.bulkUpliftAzure.getJobs.length > 0"}},{"name":"lstJobs","type":"content","item-type":"list","title":"List","edit":false,"search":false,"row":"<div class=\"jobRow\"> \n  <div class=\"jobCell address\">\n    <p class=\"name\">{{$item.CustomerName}}</p>\n    <p>{{$item.JobRef}}</p>\n    <p>{{$item.SingleLineAddress}}</p>\n    <p class=\"contact\">{{$item.Phone}}<p>\n  </div>\n  \n  <div class=\"jobCell btn\">\n    <p></p>\n  </div>\n</div>","classes":"","expressions":{},"actions":[{"name":"call_function_1","event":"click","type":"call-function","data":{"name":"setCurrentJob","params":{"rowPos":"{{$item.$index}}"}}}],"content":[{"name":"Mrs J. Jones","address":"32 Elm Grove, Glasgow, G32 5DR","phone":"07854 254 123"}],"model":"data__.azureAppServices.bulkUpliftAzure.getJobs","autoscroll":false}],"expressions":{}},{"name":"staticContextMenu","type":"area","item-type":"static","content":[{"name":"actJobList","type":"component","item-type":"web-component-es2015","template":"<activity-loader></activity-loader>","content":[],"component":"ActivityLoader","attributes":{},"actions":[],"expressions":{}},{"name":"jobListMenu","type":"component","item-type":"web-component-es2015","template":"<ct-context-menu></ct-context-menu>","content":[{"name":"btnChangePatch","type":"control","item-type":"button","content":"Change Neighbourhood","theme":"default","left-icon":"fa-map","actions":[{"event":"click","type":"inline-function","data":{"code":"var currentJob = mdm.store.data__.currentJob;\n\nif(currentJob) {\n  var popup = document.getElementById('logoutErr');\n  popup.togglePopup();\n}\nelse {\n //localStorage.noCurrentJob = 'true';\n  // Will need to delete all user data here too\n  \n  var ids = [];\n  \n  for(var i = 0; i < mdm.store.data__.azureAppServices.bulkUpliftAzure.getJobs.length; i++) {\n  \tids.push(mdm.store.data__.azureAppServices.bulkUpliftAzure.getJobs[i].JobRef)\n  }\n  \n  var goToNext = {\n    event: 'success',\n    type: 'go-to-page',\n    data: 'PatchSelect'\n  };\n  \n  var unlockJobs = {\n    endpoint: 'unlockJobs',\n    payload: {\n      jobRefs: ids\n    }\n  }\n  \n  var getNeighbourhood = {\n  \tendpoint: 'getNeighbourhoodDropdown',\n    payload: {\n    \ttemp: 'temp'\n    },\n    logout: false,\n    actions: [goToNext]\n  }\n  \n  window.commsManager.addToQueue(unlockJobs);\n  window.commsManager.addToQueue(getNeighbourhood);\n  window.commsManager.processQueue();\n  \n  mdm.utils.callAction('call-function', { \"name\": \"startSpinner\" });\n}"},"_auto_id_":"a46784fc-b67d-4028-a7b8-ca34bc676781"}],"expressions":{}},{"name":"btnLogout","type":"control","item-type":"button","content":"Log out","theme":"default","left-icon":"fa-sign-out","actions":[{"name":"inline_function_1","event":"click","type":"inline-function","data":{"code":"var currentJob = mdm.store.data__.currentJob;\n\nif(currentJob) {\n  var popup = document.getElementById('logoutErr');\n  popup.togglePopup();\n}\nelse {\n  var allResReceived = true;\n  \n  if(mdm.store.data__.completedJobs !== undefined) {\n    for(var i = 0; i < mdm.store.data__.completedJobs.length; i++) {\n      if(mdm.store.data__.completedJobs[i].responseReceived !== true) {\n        allResReceived = false;\n      }\n    }\n  }\n  \n  if(allResReceived) {\n    var ids = [];\n  \n    for(var i = 0; i < mdm.store.data__.azureAppServices.bulkUpliftAzure.getJobs.length; i++) {\n      ids.push(mdm.store.data__.azureAppServices.bulkUpliftAzure.getJobs[i].JobRef)\n    }\n    \n    if(ids.length > 0) {\n      var goToNext = {\n        event: 'success',\n        type: 'go-to-page',\n        data: 'Splash'\n      };\n\n      var message = {\n        endpoint: 'unlockJobs',\n        payload: {\n          jobRefs: ids\n        },\n        actions: [goToNext]\n      }\n\n      window.commsManager.addToQueue(message);\n      window.commsManager.processQueue();\n\n      mdm.utils.callAction('call-function', { \"name\": \"startSpinner\" });\n    }\n    else {\n      window.plugins.zumo.logout(function() { \n        console.log('Logout success');\n        window.mdm.utils.callAction('go-to-page', 'Splash');\n      }, \n      function(r) { console.log('Logout fail') });\n    }\n  }\n  else {\n    document.getElementById('popJobsRemaining').togglePopup();\n  }\n}"}}],"expressions":{}},{"name":"btnVersion","type":"control","item-type":"button","content":"Version 0.0.15","theme":"default","left-icon":"fa-code-fork","expressions":{}}],"component":"CTContextMenu","attributes":{},"actions":[],"expressions":{}},{"name":"popSelectJob","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"htmlSelectJob","type":"content","item-type":"html","content":"<p>Do you wish to start this job?</p>","expressions":{}},{"name":"btnYes","type":"control","item-type":"button","content":"Yes","theme":"default","expressions":{},"left-icon":"fa-check","classes":"green","actions":[{"name":"inline_function_1","event":"click","type":"inline-function","data":{"code":"var jobList = mdm.store.data__.azureAppServices.bulkUpliftAzure.getJobs;\nvar rowPos = mdm.store.data__.selectedRow;\nvar selectedJob = jobList[rowPos];\n\nselectedJob.current = true;\nmdm.store.data__.currentJob = selectedJob;\n\njobList.splice(rowPos, 1);\nmdm.store.data__.azureAppServices.bulkUpliftAzure.getJobs = jobList;\n\nvar remainingJobCount = jobList.length + 1;\nmdm.store.data__.remainingJobCount = remainingJobCount;\n\nvar popup = document.getElementById('selectJob');\npopup.togglePopup();\n\nif(mdm.store.Signature !== undefined) {\n  if(mdm.store.Signature.sigJobSig !== undefined) {\n    delete mdm.store.Signature.sigJobSig\n  }\n}\n\nif(mdm.store.FailJob !== undefined) {\n  delete mdm.store.FailJob.drpFail;\n  delete mdm.store.FailJob.txtFailMore;\n}\n\nmdm.utils.callAction('go-to-page', 'JobDetail');"}}]},{"name":"btnNo","type":"control","item-type":"button","content":"No","theme":"default","expressions":{},"left-icon":"fa-close","actions":[{"name":"call_function_1","event":"click","type":"call-function","data":{"name":"cancelPopup","params":{"popupId":"selectJob"}}}],"classes":"red"}],"component":"CTPopupBox","attributes":{"id":"selectJob"},"expressions":{}},{"name":"popMultiJobErr","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"htmlMultiJobErr","type":"content","item-type":"html","content":"<p>You already have a current job set. Please complete the current job first.</p>","expressions":{}},{"name":"btnOk","type":"control","item-type":"button","content":"Okay","theme":"default","expressions":{},"left-icon":"fa-check","classes":"green","actions":[{"name":"call_function_1","event":"click","type":"call-function","data":{"name":"cancelPopup","params":{"popupId":"multiJobErr"}}}]}],"component":"CTPopupBox","attributes":{"id":"multiJobErr"},"expressions":{}},{"name":"popLogoutErr","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"htmlLogoutErrMsg","type":"content","item-type":"html","content":"<p>You cannot log out or change neighbourhood whilst a job is active. Please complete the current job first.</p>","expressions":{}},{"name":"btnLogoutOk","type":"control","item-type":"button","content":"Okay","theme":"default","expressions":{},"classes":"green","actions":[{"name":"call_function_1","event":"click","type":"call-function","data":{"name":"cancelPopup","params":{"popupId":"logoutErr"}}}],"left-icon":"fa-check"}],"component":"CTPopupBox","attributes":{"id":"logoutErr"},"expressions":{}},{"name":"popJobsRemaining","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"htmlJobsRemaining","type":"content","item-type":"html","content":"<p>You still have some jobs completed on the device which haven't been returned to the server. The app will now try to send these back.</p>","expressions":{}},{"name":"btnRetryOkay","type":"control","item-type":"button","content":"Okay","theme":"default","left-icon":"fa-check","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"code":"mdm.store.data__.messageQueue = [];\n\nvar remainingJobs = [];\n\nfor(var i = 0; i < mdm.store.data__.completedJobs.length; i++) {\n  if(mdm.store.data__.completedJobs[i].responseReceived !== true) {\n    remainingJobs.push(mdm.store.data__.completedJobs[i]);\n  }\n}\n\nif(remainingJobs.length > 0) {\n  for(var i = 0; i < remainingJobs.length; i++) {\n    var currentJob = remainingJobs[i];\n    \n    if(currentJob.EvidencePhotos !== undefined) {\n  \t  if(currentJob.EvidencePhotos.length > 0) {  \n        for(var i = 0; i < currentJob.EvidencePhotos.length; i++) {\n      \n          var evidence = {\n            JobId: currentJob.Id,\n            Timestamp: moment().format(),\n            Longitude: 0,\n            Latitude: 0\n          }\n\n          if(currentJob.EvidencePhotos[i].type === 'photo') {\n            var fileName = currentJob.JobRef + '_' + (i + 1);\n            evidence.fileName = fileName;\n            evidence.EvidenceType = 'jobPhoto';\n            evidence.photoRef = currentJob.EvidencePhotos[i].img;\n          }\n          else {\n            var fileName = currentJob.JobRef + '_' + 'Sig';\n            evidence.fileName = fileName;\n            evidence.EvidenceType = 'jobSignature';\n            evidence.sigRef = currentJob.EvidencePhotos[i].img;\n          }\n\n          var evidenceMsg = {\n            endpoint: 'sendEvidence',\n            payload: evidence \n          }\n\n          window.commsManager.addToQueue(evidenceMsg);\n        }\n      }\n    }\n\n    var message = {\n      endpoint: 'updateJob',\n      payload: currentJob \n    }\n\n    window.commsManager.addToQueue(message);\n  }\n  \n  window.commsManager.processQueue();\n}"},"_auto_id_":"3d319333-38fd-4e79-8079-5fb51fecbc84"},{"event":"click","type":"call-function","data":{"name":"cancelPopup","params":{"popupId":"popJobsRemaining"}},"_auto_id_":"1ade74c5-7eb0-489a-adce-71d154f13032"}],"classes":"green"}],"component":"CTPopupBox","attributes":{"id":"popJobsRemaining"},"expressions":{}},{"name":"popAllComplete","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"htmlAllComplete","type":"content","item-type":"html","content":"<p>You have completed all the jobs on the device. What would you like to do?</p>","expressions":{}},{"name":"btnMoreJobs","type":"control","item-type":"button","content":"Request More Jobs","theme":"default","left-icon":"fa-plus-circle","expressions":{},"classes":"green","actions":[{"name":"inline_function_1","event":"click","type":"inline-function","data":{"code":"var popup = document.getElementById('allComplete');\npopup.togglePopup();"}},{"name":"go_to_page_1","event":"click","type":"go-to-page","data":"RequestJobs"}]},{"name":"btnChangeNeigh","type":"control","item-type":"button","content":"Change Neighbourhood","theme":"default","left-icon":"fa-map","expressions":{},"classes":"green","actions":[{"event":"click","type":"call-function","data":{"name":"startSpinner"},"_auto_id_":"b580f028-7bf4-4c5a-af86-266e7bd3b358"},{"event":"click","type":"call-azure-app-service","data":{"name":"bulkUpliftAzure","operation":"getNeighbourhoodDropdown"},"_auto_id_":"c9e19fde-68d8-4472-bb7c-a6cfbb1e4a2b","actions":[{"event":"success","type":"go-to-page","data":"PatchSelect","_auto_id_":"17c6dc58-2777-4e69-8fa2-44c42e87121e"},{"event":"fail","type":"call-function","data":{"name":"stopSpinner"},"_auto_id_":"588e1fd5-b4ca-4655-a785-967ee5cb1e3d"}]}]},{"name":"btnFinalLogout","type":"control","item-type":"button","content":"Logout","theme":"default","expressions":{},"classes":"red","actions":[{"event":"click","type":"inline-function","data":{"code":"var allResReceived = true;\n  \nif(mdm.store.data__.completedJobs !== undefined) {\n    for(var i = 0; i < mdm.store.data__.completedJobs.length; i++) {\n        if(mdm.store.data__.completedJobs[i].responseReceived !== true) {\n            allResReceived = false;\n        }\n    }\n}\n  \nif(allResReceived) {\n    window.plugins.zumo.logout(function() { \n      console.log('Logout success');\n      window.mdm.utils.callAction('go-to-page', 'Splash');\n    }, \n    function(r) { console.log('Logout fail') });\n}\nelse {\n    document.getElementById('popJobsRemaining').togglePopup();\n}"},"_auto_id_":"6b83263b-04cb-44f0-b590-6c04ae5c17de"}],"left-icon":"fa-sign-out"}],"component":"CTPopupBox","attributes":{"id":"allComplete"},"expressions":{}}],"expressions":{}}]},{"name":"JobDetail","config":[{"name":"On-Load Event","type":"event","item-type":"onload","actions":[{"name":"inline_function_1","event":"onload","type":"inline-function","data":{"code":"setTimeout(function() {\n  if(mdm.store.data__.currentJob.ArrivalTime === null) {\n    $('div#btnArrive').attr('classes', '');\n    $('div#btnComplete').attr('classes', 'ng-hide');\n  }\n  else {\n    $('div#btnArrive').attr('classes', 'ng-hide');\n    $('div#btnComplete').attr('classes', '');\n  }\n}, 200);"}}]}],"content":[{"name":"title_bar","type":"navigation","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"btnMenu","type":"control","item-type":"button","content":"","theme":"default","expressions":{},"right-icon":"fa-bars","actions":[{"name":"call_function_1","event":"click","type":"call-function","data":{"name":"openContextMenu"}}]}]},{"name":"staticJobDetail","type":"area","item-type":"static","content":[{"name":"htmlJobDetail","type":"content","item-type":"html","content":"<h2>Current Job (from {{'data__.currentPatch' | store}})</h2>\n\n<div class=\"jobRow full\">\n  <div class=\"jobCell full address\">\n    <p class=\"name\">{{'data__.currentJob.CustomerName' | store}}</p>\n    <p>{{'data__.currentJob.JobRef' | store}}</p>\n    <p>{{'data__.currentJob.SingleLineAddress' | store}}</p>\n    <p class=\"contact\">{{'data__.currentJob.Phone' | store}}<p>\n  </div>\n</div>","expressions":{}},{"name":"htmlJobArrived","type":"content","item-type":"html","content":"<div class=\"jobRow full\">\n  <div class=\"jobArrived\">\n    <span>Arrived at: <strong>{{'data__.currentJob.ArrivalTime' | store  | date : 'medium'}}</strong></span>\n  </div>\n</div>","expressions":{"show":"data__.currentJob.ArrivalTime"}}],"expressions":{}},{"name":"staticJobNotes","type":"area","item-type":"static","content":[{"name":"htmlJobNotes","type":"content","item-type":"html","content":"<h2>Notes</h2>\n\n<div class=\"jobNotes\">\n\t<p>{{'data__.currentJob.Notes' | store}}</p>\n</div>","expressions":{}}],"expressions":{}},{"name":"scrollInventory","type":"area","item-type":"scrollable","content":[{"name":"htmlInventory","type":"content","item-type":"html","content":"<h2>Inventory <span class=\"right\">Qty</span></h2>","expressions":{}},{"name":"lstItems","type":"content","item-type":"list","title":"List","edit":false,"search":false,"row":"<div class=\"itemRow\">\n  <p>{{$item.ItemName}}</p> <span>{{$item.Qty}}</span>\n</div>","classes":"","actions":[],"content":[{"name":"Children's Chairs","qty":4},{"name":"Children's Table","qty":1}],"model":"data__.currentJob.Items","expressions":{}}],"expressions":{}},{"name":"staticContextMenu","type":"area","item-type":"static","content":[{"name":"jobDetailMenu","type":"component","item-type":"web-component-es2015","template":"<ct-context-menu></ct-context-menu>","content":[{"name":"btnPhoto","type":"control","item-type":"button","content":"Photos","theme":"default","expressions":{},"left-icon":"fa-camera","actions":[{"name":"go_to_page_1","event":"click","type":"go-to-page","data":"Photos"}]},{"name":"btnSignature","type":"control","item-type":"button","content":"Get Signature","theme":"default","expressions":{},"left-icon":"fa-edit","actions":[{"name":"go_to_page_1","event":"click","type":"go-to-page","data":"Signature"}]}],"component":"CTContextMenu","attributes":{},"expressions":{}},{"name":"popCompleteJob","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"htmlCompleteJob","type":"content","item-type":"html","content":"<p>Would you like to mark this job as completed?</p>","expressions":{}},{"name":"btnCompleteYes","type":"control","item-type":"button","content":"Yes","theme":"default","expressions":{},"classes":"green","left-icon":"fa-check","actions":[{"event":"click","type":"inline-function","data":{"code":"var currentJob = mdm.store.data__.currentJob;\ncurrentJob.Completed = true;\ncurrentJob.Status = 'Success';\ncurrentJob.Reason = null;\ncurrentJob.FailDetail = null;\n\nmdm.addJobEvidence(currentJob);\n\nvar message = {\n  endpoint: 'updateJob',\n  payload: currentJob \n}\n\nwindow.commsManager.addToQueue(message);\n\nmdm.store.data__.completedJobs.push(currentJob);\ndelete mdm.store.data__.currentJob;\n//mdm.store.data__.api.bulkUplift.getJobs.splice(mdm.store.data__.selectedRow, 1);\nmdm.store.data__.remainingJobCount = mdm.store.data__.azureAppServices.bulkUpliftAzure.getJobs.length;\n\nif(mdm.store.Signature !== undefined) {\n  if(mdm.store.Signature.sigJobSig !== undefined) {\n    delete mdm.store.Signature.sigJobSig\n  }\n}\n\nwindow.commsManager.processQueue();\n\nmdm.utils.callAction('go-to-page', 'JobList');"},"_auto_id_":"b3411eaf-d405-41b9-9baf-d7414cb27795"},{"event":"click","type":"show-notification","data":{"options":{"schedule":false,"dynamic":true},"name":"jobFinished","title":"Job Completed","text":"Job completed successfully. Now attempting to return job data."},"_auto_id_":"5102a87e-0cab-4940-8a05-4884f1a91de3"}]},{"name":"btnCompleteNo","type":"control","item-type":"button","content":"No","theme":"default","left-icon":"fa-close","expressions":{},"classes":"red","actions":[{"event":"click","type":"call-function","data":{"name":"cancelPopup","params":{"popupId":"popCompleteJob"}},"_auto_id_":"1109b8f6-058f-4604-98ae-3df4b8810a49"}]}],"component":"CTPopupBox","attributes":{"id":"popCompleteJob"},"expressions":{},"classes":""}],"expressions":{}},{"name":"nav_footer","type":"navigation","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"btnFail","type":"control","item-type":"button","content":"Fail Job","theme":"default","expressions":{},"classes":"","actions":[{"name":"go_to_page_1","event":"click","type":"go-to-page","data":"FailJob"}]},{"name":"btnArrive","type":"control","item-type":"button","content":"Arrived at Job","theme":"default","expressions":{},"actions":[{"name":"inline_function_1","event":"click","type":"inline-function","data":{"code":"mdm.store.data__.currentJob.ArrivalTime = moment().format('YYYY-MM-DD HH:mm:ss');\n\n$('div#btnArrive').attr('classes', 'ng-hide');\n$('div#btnFail').attr('classes', '');\n$('div#btnComplete').attr('classes', '');"}}],"classes":""},{"name":"btnComplete","type":"control","item-type":"button","content":"Complete Job","theme":"default","expressions":{},"classes":"","actions":[{"event":"click","type":"call-function","data":{"name":"cancelPopup","params":{"popupId":"popCompleteJob"}},"_auto_id_":"9382509c-a472-4543-adf6-dd908137b285"}]}]}]},{"name":"Photos","config":[{"name":"On-Load Event","type":"event","item-type":"onload","actions":[{"event":"onload","type":"inline-function","data":{"code":"window.deletePhotoFromJob = function(e) {\n  localStorage.photoToDelete = e.currentTarget.getAttribute('index');\n  var popup = document.getElementById('photoDelete');\n  popup.togglePopup();\n}\n\nsetTimeout(function() {\n  var currentJob = mdm.store.data__.currentJob;\n\n  if(currentJob.EvidencePhotos !== undefined) {\n    for(var i = 0; i < currentJob.EvidencePhotos.length; i++) {\n      if(currentJob.EvidencePhotos[i].type === 'photo') {\n        // Construct HTML List item\n        var jobRow = document.createElement('div');\n        jobRow.className = 'jobRow photo';\n        jobRow.id = 'photo' + currentJob.EvidencePhotos[i].id;\n        \n        if(i === 0) {\n          jobRow.className += ' borderTop';\n        }\n        \n        var jobRowCellImage = document.createElement('div');\n        jobRowCellImage.className = 'jobCell image';\n        \n        var jobRowCellButton = document.createElement('div');\n        jobRowCellButton.className = 'jobCell button';\n        jobRowCellButton.setAttribute('index', currentJob.EvidencePhotos[i].id);\n        jobRowCellButton.onclick = window.deletePhotoFromJob;\n        \n        var jobRowCellImageImg = document.createElement('img');\n        jobRowCellImageImg.width = 131;\n        jobRowCellImageImg.height = 175;\n        jobRowCellImageImg.src = currentJob.EvidencePhotos[i].img;\n        \n        var jobRowCellButtonP = document.createElement('p');\n        \n        jobRowCellImage.appendChild(jobRowCellImageImg);\n        jobRowCellButton.appendChild(jobRowCellButtonP);\n        \n        jobRow.appendChild(jobRowCellImage);\n        jobRow.appendChild(jobRowCellButton);\n        \n        // Add to page\n        var container = document.querySelector('#htmlPhotoList > div');\n        container.appendChild(jobRow);\n      }\n    }\n  }\n}, 200);\n  "},"_auto_id_":"e8a666e6-b28d-4f2e-a6f1-8bd999df9ac8"}]}],"content":[{"name":"title_bar","type":"navigation","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"btnBack","type":"control","item-type":"button","content":"","theme":"default","left-icon":"fa-arrow-left","expressions":{},"actions":[{"name":"go_to_page_1","event":"click","type":"go-to-page","data":"JobDetail"}]}]},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"htmlPhotoList","type":"content","item-type":"html","content":"<h2>Job Photos</h2>","expressions":{}}],"expressions":{}},{"name":"nav_footer","type":"navigation","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"btnTakePhoto","type":"control","item-type":"button","content":"Take Photo","theme":"default","actions":[{"name":"inline_function_1","event":"click","type":"inline-function","data":{"code":"var currentJob = mdm.store.data__.currentJob;\n\nif(currentJob.EvidencePhotos === undefined) {\n  currentJob.EvidencePhotos = [];\n}\n\nvar length = 0;\n\nfor(var i = 0; i < currentJob.EvidencePhotos.length; i++) {\n  if(currentJob.EvidencePhotos[i].type === 'photo') {\n    length++;\n  }\n}\n\nif(length < 3) {\n  window.navigator.camera.getPicture(onCameraSuccess, onCameraError, {\n    quality: 75,\n    destinationType: 1,\n    sourceType: 1,\n    allowEdit: false,\n    encodingType: 0,\n    saveToPhotoAlbum: false,\n    correctOrientation: true,\n    targetWidth: 720,\n    targetHeight: 1280,\n    cameraDirection: 0\n  }); \n}\nelse {\n  var popup = document.getElementById('photoLimit');\n  popup.togglePopup();\n}\n\nfunction onCameraSuccess(img) {\n  console.log('CAMERA RESULT: %s', img);\n  movePhoto(img);\n}\n\nfunction onCameraError(r) {\n  console.log('CAMERA ERROR: %s', r);\n}\n\nfunction movePhoto(file) {\n  console.log(file);\n  window.resolveLocalFileSystemURI(file , resolveOnSuccess, resOnError);\n}\n\nfunction resolveOnSuccess(entry) {\n  var d = new Date();\n  var n = d.getTime();\n\n  //new file name\n  var newFileName = n + \".jpg\";\n  var myFolderApp = \"my_folder\";\n\n  window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSys) {\n    fileSys.root.getDirectory(myFolderApp, { create: true }, function(directory) {\n      entry.moveTo(directory, newFileName, function(new_entry) {\n        path = new_entry.fullPath;\n        url = new_entry.toURL();\n\n        console.log(path+\"\\n\"+url);\n\n        var currentJob = mdm.store.data__.currentJob;\n  \n        if(currentJob.EvidencePhotos.length === 0) {\n          var index = 0;\n        }\n        else {\n          var index = currentJob.EvidencePhotos[currentJob.EvidencePhotos.length - 1].id + 1;\n        }\n        \n        var imgObj = {\n          id: index,\n          type: 'photo',\n          img: url\n        };\n        \n        currentJob.EvidencePhotos.push(imgObj);\n        \n        // Construct HTML List item\n        var jobRow = document.createElement('div');\n        jobRow.className = 'jobRow photo';\n        jobRow.id = 'photo' + index;\n        \n        if(currentJob.EvidencePhotos.length === 1) {\n          jobRow.className += ' borderTop';\n        }\n        \n        var jobRowCellImage = document.createElement('div');\n        jobRowCellImage.className = 'jobCell image';\n        \n        var jobRowCellButton = document.createElement('div');\n        jobRowCellButton.className = 'jobCell button';\n        jobRowCellButton.setAttribute('index', index);\n        jobRowCellButton.onclick = window.deletePhotoFromJob;\n        \n        var jobRowCellImageImg = document.createElement('img');\n        jobRowCellImageImg.width = 131;\n        jobRowCellImageImg.height = 175;\n        jobRowCellImageImg.src = imgObj.img;\n        \n        var jobRowCellButtonP = document.createElement('p');\n        \n        jobRowCellImage.appendChild(jobRowCellImageImg);\n        jobRowCellButton.appendChild(jobRowCellButtonP);\n        \n        jobRow.appendChild(jobRowCellImage);\n        jobRow.appendChild(jobRowCellButton);\n        \n        // Add to page\n        var container = document.querySelector('#htmlPhotoList > div');\n        container.appendChild(jobRow);\n        mdm.utils.updatePage();\n      }, \n      resOnError);\n    },\n    resOnError);\n  },\n  resOnError);\n}\n\nfunction resOnError(error) {\n  alert('Error '+error.code+': '+error.message);\n}"}}],"expressions":{}}]},{"name":"staticComponentCont","type":"area","item-type":"static","content":[{"name":"popPhotoError","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"htmlMessage","type":"content","item-type":"html","content":"<p>You can only take a maximum of 3 photos per job. Please delete at least one photo first.</p>","expressions":{}},{"name":"btnPhotoOkay","type":"control","item-type":"button","content":"Okay","theme":"default","expressions":{},"actions":[{"name":"call_function_1","event":"click","type":"call-function","data":{"name":"cancelPopup","params":{"popupId":"photoLimit"}}}],"classes":"green","left-icon":"fa-check"}],"component":"CTPopupBox","attributes":{"id":"photoLimit"},"expressions":{},"actions":[]},{"name":"popDeletePhoto","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"htmlPhotoDelete","type":"content","item-type":"html","content":"<p>Are you sure you wish to delete this photo from the job?</p>","expressions":{}},{"name":"btnDeleteYes","type":"control","item-type":"button","content":"Yes","theme":"default","expressions":{},"classes":"green","left-icon":"fa-check","actions":[{"name":"inline_function_1","event":"click","type":"inline-function","data":{"code":"var index = parseInt(localStorage.photoToDelete);\nvar currentJob = mdm.store.data__.currentJob;\n\nfor(var i = 0; i < currentJob.EvidencePhotos.length; i++) {\n \tif(index == currentJob.EvidencePhotos[i].id && currentJob.EvidencePhotos[i].type === 'photo') {\n      currentJob.EvidencePhotos.splice(i, 1);\n      break;\n    }\n}\n\nvar jobRow = document.querySelector('#photo' + index);\njQuery(jobRow).remove();\n\n// TODO: Delete file from disk\n\nvar popup = document.getElementById('photoDelete');\npopup.togglePopup();"}}]},{"name":"btnPhotoNo","type":"control","item-type":"button","content":"No","theme":"default","left-icon":"fa-close","actions":[{"name":"call_function_1","event":"click","type":"call-function","data":{"name":"cancelPopup","params":{"popupId":"photoDelete"}}}],"expressions":{},"classes":"red"}],"component":"CTPopupBox","attributes":{"id":"photoDelete"},"expressions":{}}],"expressions":{}}]},{"name":"Signature","config":[{"name":"On-Load Event","type":"event","item-type":"onload","actions":[{"name":"inline_function_1","event":"onload","type":"inline-function","data":{"code":"if(1 == 2) {\n  setTimeout(function() {\n    var canvas = document.getElementsByTagName('canvas')[0];\n    canvas.width = window.innerWidth;\n\n    if(mdm.store.Signature.sigJobSig !== undefined) {\n      var sig = new SignaturePad(document.getElementsByTagName('canvas')[0]);\n\n      sig.fromDataURL(mdm.store.Signature.sigJobSig);\n    }\n  }, 200);\n}"}}]}],"content":[{"name":"title_bar","type":"navigation","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"btnBack","type":"control","item-type":"button","content":"","theme":"default","left-icon":"fa-arrow-left","actions":[{"name":"go_to_page_1","event":"click","type":"go-to-page","data":"JobDetail"}],"expressions":{}}]},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"sigJobSig","type":"question","item-type":"signature","label":"","required":false,"expressions":{},"validators":[],"actions":[]}]},{"name":"nav_footer","type":"navigation","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"btnConfirm","type":"control","item-type":"button","content":"Confirm","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"code":"if(mdm.store.Signature.sigJobSig !== undefined) {\n  var currentJob = mdm.store.data__.currentJob;\n\n  if(currentJob.EvidencePhotos === undefined) {\n    currentJob.EvidencePhotos = [];\n  }\n\n  var sigData = mdm.store.Signature.sigJobSig.substring(16)\n\n  var imgObj = {\n    id: 999,\n    type: 'signature',\n    img: sigData\n  };\n\n  currentJob.EvidencePhotos.push(imgObj)\n}"},"_auto_id_":"45d01b4a-82c5-42e0-b217-2bcb005240ef"},{"name":"go_to_page_1","event":"click","type":"go-to-page","data":"JobDetail"}]}]}]},{"name":"PatchSelect","config":[],"content":[{"name":"title_bar","type":"navigation","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"btnBack","type":"control","item-type":"button","content":"","theme":"default","left-icon":"fa-arrow-left","actions":[{"event":"click","type":"inline-function","data":{"code":"var popup = document.getElementById('loloutConfirmation');\npopup.togglePopup();"},"_auto_id_":"b2dadce4-8167-47de-9902-eca2475cb7f0"}],"expressions":{}}]},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"drpPatchSelect","type":"question","item-type":"select","label":"Select Neighbourhood","required":true,"options":[{"label":"Option 1","value":1},{"label":"Option 2","value":2},{"label":"WEEE","value":3}],"expressions":{},"message":"This is a required field","option-source":"data__.azureAppServices.bulkUpliftAzure.getNeighbourhoodDropdown.res","validators":[],"actions":[],"label-property":"label","value-property":"value"}]},{"name":"nav_footer","type":"navigation","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"btnNext","type":"control","item-type":"button","content":"Request Jobs","theme":"default","expressions":{"disabled":"PatchSelect.drpPatchSelect.value === undefined"},"actions":[{"event":"click","type":"call-function","data":{"name":"startSpinner"},"_auto_id_":"696b134b-2c4b-4a06-b512-47fbe06ac413"},{"name":"inline_function_2","event":"click","type":"inline-function","data":{"code":"delete mdm.store.data__.jobList;\nmdm.store.data__.currentPatch = mdm.store.PatchSelect.drpPatchSelect.value;"}},{"event":"click","type":"call-azure-app-service","data":{"name":"bulkUpliftAzure","operation":"getJobs","params":{"neightbourhood":"{{PatchSelect.drpPatchSelect.value}}","neighbourhood":"{{PatchSelect.drpPatchSelect.value}}","numberToGet":"30"}},"_auto_id_":"6ec1f57a-9ef8-437f-bb6c-bb5e6b008b13","actions":[{"event":"fail","type":"call-function","data":{"name":"stopSpinner"},"_auto_id_":"041d47d0-64ba-4e38-87ed-18e424264bec"},{"event":"success","type":"inline-function","data":{"code":"if(mdm.store.data__.azureAppServices.bulkUpliftAzure.getJobs.length === 0) {\n  mdm.stopSpinner();\n  var popup = document.getElementById('noJobsMatch');\n  popup.togglePopup();\n}\nelse {\n  delete mdm.store.PatchSelect.drpPatchSelect;\n  mdm.store.data__.completedJobs = [];\n  mdm.utils.callAction('go-to-page', 'JobList');\n}"},"_auto_id_":"2e8b187d-56dc-4720-bcf5-51dccad6cdb1"}]}]}]},{"name":"static_13","type":"area","item-type":"static","content":[{"name":"popNoJobs","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"htmlNoJobs","type":"content","item-type":"html","content":"<p>No jobs found for this neighbourhood. Please try another neighbourhood.</p>","expressions":{}},{"name":"btnNoJobsOk","type":"control","item-type":"button","content":"Okay","theme":"default","left-icon":"fa-check","actions":[{"event":"click","type":"call-function","data":{"name":"cancelPopup","params":{"popupId":"noJobsMatch"}},"_auto_id_":"9660303c-7b69-47d1-8b2e-bdc9c5358a1d"}],"expressions":{},"classes":"green"}],"component":"CTPopupBox","attributes":{"id":"noJobsMatch"},"expressions":{},"actions":[]},{"name":"popLogout","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"htmlLogout","type":"content","item-type":"html","content":"<p>Would you like to logout?</p>","expressions":{}},{"name":"btnYes","type":"control","item-type":"button","content":"Yes","theme":"default","left-icon":"fa-check","expressions":{},"classes":"green","actions":[{"event":"click","type":"inline-function","data":{"code":"window.plugins.zumo.logout(function() { \n  console.log('Logout success');\n  window.mdm.utils.callAction('go-to-page', 'Splash');\n}, \nfunction(r) { console.log('Logout fail') });"},"_auto_id_":"ae06bc75-c4ca-4d8d-906e-f9f2c90c8e78"}]},{"name":"btnNo","type":"control","item-type":"button","content":"No","theme":"default","left-icon":"fa-close","actions":[{"event":"click","type":"call-function","data":{"name":"cancelPopup","params":{"popupId":"loloutConfirmation"}},"_auto_id_":"b383b0a2-4547-44a8-aefa-0b5f37860d2d"}],"expressions":{},"classes":"red"}],"component":"CTPopupBox","attributes":{"id":"loloutConfirmation"},"expressions":{}},{"name":"ActivityLoader_2","type":"component","item-type":"web-component-es2015","template":"<activity-loader></activity-loader>","content":[],"component":"ActivityLoader","attributes":{},"actions":[],"expressions":{}}]}]},{"name":"FailJob","config":[{"name":"On-Load Event","type":"event","item-type":"onload","actions":[{"event":"onload","type":"inline-function","data":{"code":"setTimeout(function() {\n  if(mdm.store.data__.currentJob.Reason !== null) {\n    document.querySelector('a#btnSelectReason').textContent = mdm.store.data__.currentJob.Reason;\n  }\n}, 200);"},"_auto_id_":"74fd151d-6571-45a9-a716-e4db79c18fd4"}]}],"content":[{"name":"title_bar","type":"navigation","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"btnBack","type":"control","item-type":"button","content":"","theme":"default","expressions":{},"actions":[{"name":"go_back_1","event":"click","type":"go-back","data":{}}],"left-icon":"fa-arrow-left"}]},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"htmlHeading","type":"content","item-type":"html","content":"<h2>Fail Job</h2>","expressions":{}},{"name":"btnSelectReason","type":"control","item-type":"button","content":"Select fail reason...","theme":"default","actions":[{"event":"click","type":"call-function","data":{"name":"cancelPopup","params":{"popupId":"popFailReason"}},"_auto_id_":"ed3e643c-7d99-416d-8a39-7ac641a8db82"}],"expressions":{}},{"name":"txtFailMore","type":"question","item-type":"text","label":"More Information:","required":false,"multiline":true,"debounce":250,"expressions":{},"validators":[],"actions":[]}]},{"name":"nav_footer","type":"navigation","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"btnFailConfirm","type":"control","item-type":"button","content":"Confirm","theme":"default","expressions":{},"actions":[{"name":"inline_function_1","event":"click","type":"inline-function","data":{"code":"// Mark job as failed, etc\nvar currentJob = mdm.store.data__.currentJob;\n\nif(currentJob.Reason === null) {\n  var popup = document.getElementById('popAddReason');\n  popup.togglePopup();\n}\nelse if(currentJob.Reason == 'Other' && (mdm.store.FailJob.txtFailMore == undefined || mdm.store.FailJob.txtFailMore == \"\")) {\n  var popup = document.getElementById('addOther');\n  popup.togglePopup();\n}\nelse {\n  currentJob.Completed = true;\n  currentJob.Status = 'Failed';\n  //currentJob.Reason = mdm.store.FailJob.drpFail.label;\n  currentJob.FailDetail = mdm.store.FailJob.txtFailMore || null;\n  \n  mdm.addJobEvidence(currentJob);\n  \n  var message = {\n    endpoint: 'updateJob',\n    payload: currentJob \n  }\n\n  window.commsManager.addToQueue(message);\n\n  mdm.store.data__.completedJobs.push(currentJob);\n  delete mdm.store.data__.currentJob;\n  mdm.store.data__.remainingJobCount = mdm.store.data__.azureAppServices.bulkUpliftAzure.getJobs.length;\n\n  if(mdm.store.Signature !== undefined) {\n    if(mdm.store.Signature.sigJobSig !== undefined) {\n      delete mdm.store.Signature.sigJobSig\n    }\n  }\n  \n  window.commsManager.processQueue();\n  \n  mdm.utils.callAction('go-to-page', 'JobList');\n  mdm.utils.callAction('show-notification', {\"options\": { \"schedule\": false, \"dynamic\": true }, \"name\": \"jobFinished\", \"title\": \"Job Completed\", \"text\": \"Job marked as failed. Now attempting to return job data.\" });\n}"}}]}]},{"name":"static_14","type":"area","item-type":"static","content":[{"name":"popAddReason","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"htmlSpecifyFail","type":"content","item-type":"html","content":"<p>Please select a reason for failing this job.</p>","expressions":{}},{"name":"btnFailOkay","type":"control","item-type":"button","content":"Okay","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-function","data":{"name":"cancelPopup","params":{"popupId":"popAddReason"}},"_auto_id_":"139fbd5e-ea37-4a1a-84fc-41d8f3559da2"}],"classes":"green","left-icon":"fa-check"}],"component":"CTPopupBox","attributes":{"id":"popAddReason"},"expressions":{}},{"name":"popAddOther","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"htmlAddOther","type":"content","item-type":"html","content":"<p>Please add more information when selecting 'other'.</p>","expressions":{}},{"name":"btnOkay","type":"control","item-type":"button","content":"Okay","theme":"default","left-icon":"fa-check","expressions":{},"classes":"green","actions":[{"event":"click","type":"call-function","data":{"name":"cancelPopup","params":{"popupId":"addOther"}},"_auto_id_":"0dd748c2-4c2a-400a-abc3-92ca4144d68f"}]}],"component":"CTPopupBox","attributes":{"id":"addOther"},"expressions":{}},{"name":"popFailReason","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"htmlFail","type":"content","item-type":"html","content":"<p>Please select a fail reason:</p>","expressions":{}},{"name":"btnFail1","type":"control","item-type":"button","content":"Not found e.g. lifted by white van man","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-function","data":{"name":"setFailReason","params":{"reason":"Not found e.g. lifted by white van man"}},"_auto_id_":"eab38598-ac5f-466d-88b0-92d5a66cf077"}]},{"name":"btnFail2","type":"control","item-type":"button","content":"Not in location provided","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-function","data":{"name":"setFailReason","params":{"reason":"Not in location provided"}},"_auto_id_":"6b985e4f-7e4d-493e-a713-4de69de8df7a"}]},{"name":"btnFail3","type":"control","item-type":"button","content":"No access e.g parking/gate locked","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-function","data":{"name":"setFailReason","params":{"reason":"No access e.g parking/gate locked"}},"_auto_id_":"bf61893b-d555-415e-b31c-cd1cd81bb63a"}]},{"name":"btnFail4","type":"control","item-type":"button","content":"Not presented correctly e.g tied/nails","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-function","data":{"name":"setFailReason","params":{"reason":"Not presented correctly e.g tied/nails"}},"_auto_id_":"5928ca92-77ac-4dea-841c-abfe2fe2d4e3"}]},{"name":"btnFail5","type":"control","item-type":"button","content":"Too heavy e.g cast iron bath","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-function","data":{"name":"setFailReason","params":{"reason":"Too heavy e.g cast iron bath"}},"_auto_id_":"216519dd-7ade-492e-82aa-a2f41fa06787"}]},{"name":"btnFail6","type":"control","item-type":"button","content":"Contractor involved, chargeable items","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-function","data":{"name":"setFailReason","params":{"reason":"Contractor involved, chargeable items"}},"_auto_id_":"11b8edc4-ce62-4e91-837b-143778846207"}]},{"name":"btnFail7","type":"control","item-type":"button","content":"Part uplift, in phases (house clearance)","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-function","data":{"name":"setFailReason","params":{"reason":"Part uplift, in phases (house clearance)"}},"_auto_id_":"271bdb8f-409b-49f7-a140-95bc86e28844"}]},{"name":"btnFail8","type":"control","item-type":"button","content":"Other","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-function","data":{"name":"setFailReason","params":{"reason":"Other"}},"_auto_id_":"1b44729d-3f28-425a-ace9-d9ab3ff1ebba"}]},{"name":"btnReasonCancel","type":"control","item-type":"button","content":"Cancel","theme":"default","actions":[{"event":"click","type":"call-function","data":{"name":"cancelPopup","params":{"popupId":"popFailReason"}},"_auto_id_":"0faa1571-1c9a-4b09-ba33-dfb2e30c7240"}],"expressions":{},"classes":"red"}],"component":"CTPopupBox","attributes":{"id":"popFailReason"},"expressions":{}}]}]},{"name":"RequestJobs","config":[],"content":[{"name":"title_bar","type":"navigation","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"btnBack","type":"control","item-type":"button","content":"","theme":"default","left-icon":"fa-arrow-left","expressions":{},"actions":[{"name":"go_back_1","event":"click","type":"go-back","data":{}}]}]},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"sliNoOfJobs","type":"question","item-type":"slider","label":"Number of Jobs:","required":false,"dual":false,"min":5,"max":30,"step":5,"message":"This is a required field","validators":[],"actions":[],"expressions":{}}]},{"name":"nav_footer","type":"navigation","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"btnRequestJobs","type":"control","item-type":"button","content":"Request Jobs","theme":"default","expressions":{},"actions":[{"name":"if_1","type":"if","data":{},"operations":[{"type":"value","content":"{{data__.azureAppServices.bulkUpliftAzure.getJobs.length}}"},{"type":"operator","content":">"},{"type":"value","content":"0"}]},{"name":"inline_function_1","event":"click","type":"inline-function","data":{"code":"var popup = document.getElementById('jobsError');\npopup.togglePopup();"}},{"name":"otherwise_1","type":"otherwise","data":{}},{"event":"click","type":"call-function","data":{"name":"startSpinner"},"_auto_id_":"78f21b07-7bba-4c65-91b2-45902fef0d48"},{"event":"click","type":"call-azure-app-service","data":{"name":"bulkUpliftAzure","operation":"getJobs","params":{"neighbourhood":"{{data__.currentPatch}}","numberToGet":"{{RequestJobs.sliNoOfJobs}}"}},"_auto_id_":"6c564357-77a9-4c71-8126-638df0368788","actions":[{"event":"fail","type":"call-function","data":{"name":"stopSpinner"},"_auto_id_":"68c05872-7250-4a55-884d-af9553be7675"},{"event":"success","type":"inline-function","data":{"code":"if(mdm.store.data__.azureAppServices.bulkUpliftAzure.getJobs.length === 0) {\n  mdm.stopSpinner();\n  var popup = document.getElementById('noJobsMatch');\n  popup.togglePopup();\n}\nelse {\n  mdm.utils.callAction('go-to-page', 'JobList');\n}"},"_auto_id_":"9e934994-8315-4326-8a11-749986d17e8c"}]}]}]},{"name":"staticCompContainer","type":"area","item-type":"static","content":[{"name":"ActivityLoader_3","type":"component","item-type":"web-component-es2015","template":"<activity-loader></activity-loader>","content":[],"component":"ActivityLoader"},{"name":"popJobsError","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"htmlJobsError","type":"content","item-type":"html","content":"<p>You already have jobs on the device. Please complete these before requesting more.</p>","expressions":{}},{"name":"btnOkayJobsError","type":"control","item-type":"button","content":"Okay","theme":"default","expressions":{},"actions":[{"name":"call_function_1","event":"click","type":"call-function","data":{"name":"cancelPopup","params":{"popupId":"jobsError"}}}],"classes":"green","left-icon":"fa-check"}],"component":"CTPopupBox","attributes":{"id":"jobsError"},"expressions":{}},{"name":"popNoJobs","type":"component","item-type":"web-component-es2015","template":"<ct-popup-box></ct-popup-box>","content":[{"name":"htmlNoJobs","type":"content","item-type":"html","content":"<p>No jobs found for the selected neighbourhood. Please select another neighbourhood.</p>","expressions":{}},{"name":"btnNoJobsOkay","type":"control","item-type":"button","content":"Okay","theme":"default","expressions":{},"classes":"green","left-icon":"fa-check","actions":[{"name":"go_to_page_1","event":"click","type":"go-to-page","data":"PatchSelect"}]}],"component":"CTPopupBox","attributes":{"id":"noJobsMatch"},"expressions":{},"actions":[]}],"expressions":{}}]},{"name":"CompletedJobs","config":[],"content":[{"name":"title_bar","type":"navigation","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"btnBack","type":"control","item-type":"button","content":"","theme":"default","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":"JobList","_auto_id_":"9a4d4894-abf5-46c0-af22-6b784265e62f"}],"left-icon":"fa-arrow-left"}]},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"htmlCompletedJobs","type":"content","item-type":"html","content":"<h2>Completed Jobs</h2>","expressions":{}},{"name":"lstCompletedJobs","type":"content","item-type":"list","title":"List","edit":false,"search":false,"row":"<div class=\"jobRow\"> \n  <div class=\"jobCell address full {{$item.responseReceived ? 'completed' : ''}}\">\n    <p class=\"name\">{{$item.CustomerName}}</p>\n    <p>{{$item.JobRef}}</p>\n    <p>{{$item.SingleLineAddress}}</p>\n    <p class=\"contact\">{{$item.Phone}}<p>\n  </div>\n</div>","classes":"","expressions":{},"content":[],"actions":[],"model":"data__.completedJobs"}]}]}],"config":[{"name":"theme_1","type":"style","item-type":"theme","content":"body{background-color:#f3f3f3}h1,h2,h3,h4,h5,h6,p{font-family:Helvetica !important;color:#555}h2{font-size:16px;font-weight:bold;margin-top:20px;margin-left:3vw;clear:both}h2 span.right{float:right;margin-right:3vw}.btn-default:hover{background-color:initial;border-color:initial;color:white}activity-loader{display:flex;position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.4)}activity-loader.hidden{display:none}activity-loader i{margin:auto}activity-loader i:before{font-family:FontAwesome;text-align:center;font-size:48px;font-style:normal;color:#3E788F;content:\"\\f254\";-webkit-animation:spin 4s linear infinite;animation:spin 4s linear infinite}@-webkit-keyframes spin{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}section[item-type=\"static\"],section[item-type=\"scrollable\"]{border:none !important;background-color:#f3f3f3;-webkit-box-shadow:none;box-shadow:none;padding:0 !important}section[item-type=\"scrollable\"]{overflow-y:auto}section[item-type=\"static\"] ul,section[item-type=\"scrollable\"] ul{list-style:none !important;margin:0 !important;padding:0 !important}.md-list ul li{position:initial !important}.md-list .scrollable{overflow-y:auto !important;margin:0 !important}.app-container,.page-container{background-color:#f3f3f3}.content-block{margin-bottom:0 !important}#staticSplash{background-color:#3E788F;height:80vh}#staticSplash img{margin:3vh 10vw 3vh;width:8vw;min-width:98px;min-height:160px}#staticSplash h2{color:white;line-height:58px;font-size:48px;font-weight:bold;margin-left:10vw;margin-bottom:5vh}#staticSplash a#btnStart,#staticSplash a#btnStart:hover{border:1px solid white !important;color:white !important;border-radius:5px;background-color:#3E788F !important;width:40vw;padding:2vh 0}#staticDescription{height:20vh}#staticDescription p{text-align:center;margin:5vw}#staticDescription p.version{position:absolute;bottom:15px;right:15px;color:#ddd;margin:0;font-size:10px}#staticDescription p.version:before{font-family:FontAwesome;content:\"\\f126\";margin-right:10px}#titleJobsList,#title_bar,#nav_footer{background-color:#3E788F;color:white;justify-content:flex-end}#titleJobsList a#btnMenu,#title_bar a#btnMenu,#title_bar a#btnBack,#nav_footer div a,#title_bar a.btn-default:hover{background-color:#3E788F !important;color:white !important;border:none !important}#title_bar div#btnBack{margin-right:auto}#nav_footer{justify-content:center}#nav_footer div{flex-basis:50%}#nav_footer div[classes=\"ng-hide\"]{display:none}#nav_footer div a{font-size:20px}.contextMenuBG{position:absolute;width:100vw;height:100vh;top:0;left:0;background-color:rgba(0,0,0,0.3);z-index:999}ct-context-menu .contextMenuBG .contextMenu{position:absolute;width:60vw;height:100vh;top:0;right:-60vw;background-color:rgba(0,0,0,0.6);z-index:1000;-webkit-animation:slide .5s forwards}@-webkit-keyframes slide{100%{right:0}}@keyframes slide{100%{right:0}}ct-context-menu .contextMenuBG .contextMenu div{margin:0;border-bottom:1px solid white}ct-context-menu .contextMenuBG .contextMenu div a,ct-context-menu .contextMenuBG .contextMenu div a:hover{color:white !important;border:none;background-color:transparent !important;width:100%;padding:3vh 0;text-align:left;margin-left:3vw}ct-context-menu .contextMenuBG .contextMenu div a span span:before{margin-right:3vw;width:8vw;display:inline-block;text-align:center}ct-context-menu[popup=\"true\"] .contextMenuBG{background-color:transparent}ct-context-menu[popup=\"true\"] .contextMenu{position:absolute;z-index:1000;background-color:white;border:1px solid #d3d3d3;height:initial;-webkit-animation:none}ct-context-menu[popup=\"true\"] .contextMenuBG .contextMenu div{border-top:1px solid #d3d3d3}ct-context-menu[popup=\"true\"] .contextMenuBG .contextMenu div:first-child{border-top:none}ct-context-menu[popup=\"true\"] .contextMenuBG .contextMenu div a,ct-context-menu[popup=\"true\"] .contextMenuBG .contextMenu div a:hover{color:black !important;margin-left:0;text-align:center;padding:2vh 0}ct-popup-box div.popupBG{display:flex;position:absolute;top:0;left:0;width:100vw;height:100vh;background-color:rgba(0,0,0,0.6);z-index:999}ct-popup-box div.popupBG div.popupBox{width:80vw;background-color:white;margin:auto;display:flex;flex-wrap:wrap;justify-content:center}ct-popup-box md-content{margin:2vh auto;text-align:center;padding:3vh 4vw 0}ct-popup-box .md-button-container{margin:0 auto !important;width:72vw}ct-popup-box .md-button-container a,ct-popup-box .md-button-container a:hover{color:white !important;width:100%;border:none;padding:2vh 0;margin-bottom:2vh}ct-popup-box div[classes=\"green\"] a,ct-popup-box div[classes=\"green\"] a:hover{background-color:green !important}ct-popup-box div[classes=\"red\"] a,ct-popup-box div[classes=\"red\"] a:hover{background-color:red !important}ct-popup-box#popFailReason md-content{margin:0 auto 1vh;padding:2vh 4vw 0}ct-popup-box#popFailReason .md-button-container a,ct-popup-box#popFailReason .md-button-container a:hover{color:black !important;border:1px solid black;padding:1vh 0;margin-bottom:1vh;white-space:normal}ct-popup-box#popFailReason div[classes=\"red\"] a,ct-popup-box#popFailReason div[classes=\"red\"] a:hover{color:white !important;border:1px solid red}.box{width:50vw;height:15vh;display:flex;flex-direction:column;border:1px solid #d3d3d3;float:left;background-color:white;text-align:center}.box:nth-child(3),.box:nth-child(4){border-left:none}.box h3{word-wrap:break-word;white-space:pre-line;margin:auto 2vw;font-size:18px}.box h3 span{font-size:62px}.box.btn{width:30vw;background-color:#3E788F}.box.btn h3{color:white;line-height:28px}.jobRow{clear:both;margin:0}.jobRow.full{margin:0 !important}.jobRow .jobCell{float:left;border-left:1px solid #d3d3d3;border-right:1px solid #d3d3d3;border-bottom:1px solid #d3d3d3;height:12vh;display:flex;flex-direction:column}ul li:first-child span div.jobRow .jobCell{border-top:1px solid #d3d3d3}.jobRow.borderTop .jobCell{margin-bottom:20px;border-top:1px solid #d3d3d3}.jobRow .jobCell p{margin:auto 3vw;padding:0}.jobRow .jobCell.location{width:15vw;background-color:#d3d3d3;border-bottom:1px solid white;flex-direction:row}.jobRow .jobCell.location p,.jobRow .jobCell.btn p{margin:auto}.jobRow .jobCell.location p:before{font-family:FontAwesome;content:\"\\f041\";font-size:28px}.jobRow .jobCell.address{width:85vw;background-color:white}.jobRow .jobCell.address p.name{font-weight:bold}.jobRow .jobCell.address p.contact,.jobRow .jobCell.address p.contact a{font-weight:bold;color:#3E788F}.jobRow .jobCell.address.completed{background-color:#dff0d8}.jobRow .jobCell.btn{width:15vw;background-color:#3E788F;color:white}.jobRow .jobCell.btn p:before{font-family:FontAwesome;content:\"\\f054\";color:white;font-size:28px}.jobRow .jobCell.full{width:100vw !important;border-top:1px solid #d3d3d3}.jobRow .jobCell:nth-child(3),.jobRow .jobCell:nth-child(4){border-left:none}.jobRow .jobArrived{background-color:#dff0d8;text-align:center;padding:2vh 0;color:#3c763d;border-bottom:1px solid #d6e9c6}.jobRow.photo .jobCell{height:175px;backround-color:white}.jobRow.photo .jobCell img,.jobRow.photo .jobCell p{margin:auto !important;text-align:center}.jobRow.photo .jobCell.image,.jobRow.photo .jobCell.button{width:50vw;border-right:none;margin-bottom:0 !important}.jobRow.photo .jobCell.button{background-color:#3E788F}.jobRow.photo .jobCell.button p:before{font-family:FontAwesome;content:\"\\f1f8\";color:white;font-size:28px}div.jobNotes{padding:2vh 0;background-color:white;border:1px solid #d3d3d3;display:flex}div.jobNotes p{margin:auto 3vw}.itemRow{background-color:white;padding:1vh 3vw;display:flex;justify-content:flex-start;border-bottom:1px solid #d3d3d3}ul li:first-child span div.itemRow{border-top:1px solid #d3d3d3}.itemRow p{margin:0}.itemRow span{margin-left:auto}md-question div{margin:3vh 1vw 0}div#txtFailMore label{margin-left:2vw}textarea.form-control{height:35vh}.btn-default:hover{background-color:white !important;border-color:#ccc !important;color:#333 !important}div#btnSelectReason{text-align:left;margin-left:3vw}@media only screen and (min-device-width:320px) and (max-device-width:568px){.box h3{font-size:12px}.box h3 span{font-size:42px}.box.btn h3{line-height:20px}.jobRow .jobCell{height:18vh}}"},{"name":"bulkUplift","type":"integration","item-type":"api","headers":{},"params":[],"operations":[{"name":"authTest","summary":"Authorisation test","path":"authtest","method":"POST","content-type":"application/json"},{"name":"getNeighbourhoods","summary":"Gets neighbourhood dropdown values","path":"getNeighbourhoodDropdown","method":"GET","content-type":"application/json"},{"name":"getJobs","summary":"Gets jobs for selected neighbourhood","path":"getJobs","method":"GET","content-type":"application/json","params":[{"name":"Neighbourhood","description":"Neighbourhood of jobs","type":"string","typeConfig":{},"in":"query","required":true}]},{"name":"unlockJobs","summary":"Unlocks remaining jobs","path":"unlockJobs","method":"POST","content-type":"application/json","params":[{"name":"jobRefs","description":"jobRefs","type":"string","typeConfig":{},"in":"body","required":true}]},{"name":"updateJob","summary":"Updates a job","path":"updateJob","method":"POST","content-type":"application/json","params":[{"name":"job","description":"Job Object","type":"string","typeConfig":{},"in":"body","required":true}]}],"url":"http://ct-nick-test.ngrok.io/api/"},{"name":"openContextMenu","type":"script","item-type":"function","params":[],"content":"var contextMenu = document.getElementsByTagName('ct-context-menu')[0]\ncontextMenu.toggleMenu();","sync":true},{"name":"setCurrentJob","type":"script","item-type":"function","params":[{"name":"rowPos","required":true}],"content":"var currentJob = mdm.store.data__.currentJob;\n\nif(currentJob) {\n  var popup = document.getElementById('multiJobErr');\n  popup.togglePopup();\n}\nelse {  \n  mdm.store.data__.selectedRow = rowPos;\n  \n  var popup = document.getElementById('selectJob');\n  popup.togglePopup();\n}"},{"name":"cancelPopup","type":"script","item-type":"function","params":[{"name":"popupId","required":true}],"content":"var popup = document.getElementById(popupId);\npopup.togglePopup();"},{"name":"addJobEvidence","type":"script","item-type":"function","params":[{"name":"currentJob"}],"content":"if(currentJob.EvidencePhotos !== undefined) {\n  if(currentJob.EvidencePhotos.length > 0) {  \n    for(var i = 0; i < currentJob.EvidencePhotos.length; i++) {\n      \n      var evidence = {\n        JobId: currentJob.Id,\n        Timestamp: moment().format(),\n        Longitude: 0,\n        Latitude: 0\n      }\n      \n      if(currentJob.EvidencePhotos[i].type === 'photo') {\n        var fileName = currentJob.JobRef + '_' + (i + 1);\n        evidence.fileName = fileName;\n        evidence.EvidenceType = 'jobPhoto';\n        evidence.photoRef = currentJob.EvidencePhotos[i].img;\n      }\n      else {\n        var fileName = currentJob.JobRef + '_' + 'Sig';\n        evidence.fileName = fileName;\n        evidence.EvidenceType = 'jobSignature';\n        evidence.sigRef = currentJob.EvidencePhotos[i].img;\n      }\n      \n      delete currentJob.EvidencePhotos[i].img;\n      \n      var evidenceMsg = {\n        endpoint: 'sendEvidence',\n        payload: evidence \n      }\n      \n      window.commsManager.addToQueue(evidenceMsg);\n    }\n  }\n}"},{"name":"jobFinished","type":"notification","item-type":"app-notification","options":{"autoDismiss":true,"closeButton":true},"style":"success","actions":[]},{"name":"js_asset_1","type":"script","item-type":"js-asset","fileName":"Moment.js"},{"name":"js_asset_2","type":"script","item-type":"js-asset","fileName":"startUpScripts.js"},{"name":"js_asset_3","type":"script","item-type":"js-asset","fileName":"commsManager.js"},{"name":"bulkUpliftAzure","type":"integration","item-type":"azure-app-services","headers":{},"params":[],"operations":[{"ttlMinutes":0,"name":"getNeighbourhoodDropdown","summary":"Gets the neighbourhood dropdown values","path":"getNeighbourhoodDropdown","method":"GET","params":[{"name":"payload","description":"payload","type":"string","typeConfig":{}}]},{"ttlMinutes":0,"name":"getJobs","path":"getJobs","summary":"Gets jobs for selected neighbourhood","method":"GET","params":[{"name":"neighbourhood","description":"Selected neighbourhood","type":"string","typeConfig":{},"required":true},{"name":"numberToGet","description":"Number of jobs to get","type":"string","typeConfig":{},"default":"10","required":true}]},{"ttlMinutes":0,"name":"updateJob","path":"updateJob","summary":"Update a job","method":"POST","params":[{"name":"payload","description":"payload","type":"string","typeConfig":{}}]},{"ttlMinutes":0,"name":"sendEvidence","path":"sendEvidence","summary":"Send evidence","method":"POST","params":[{"name":"payload","description":"payload","type":"string","typeConfig":{}},{"name":"photoRef","description":"photoRef","type":"fileref","typeConfig":{}}]},{"ttlMinutes":0,"name":"unlockJobs","summary":"unlockJobs","path":"unlockJobs","method":"POST","params":[{"name":"payload","description":"payload","type":"string","typeConfig":{}}]}],"aasUseBlobStorage":false,"aasUrl":"http://ct-nick-test.ngrok.io/","aasAuthenticationMethod":"windowsazureactivedirectory"},{"name":"image_asset_1","type":"style","item-type":"image-asset","fileName":"Glasgow-City-Council-logo-small-3.png"},{"name":"startSpinner","type":"script","item-type":"function","params":[],"content":"var loader = document.getElementsByTagName('activity-loader')[0];\nloader.show();","sync":false},{"name":"stopSpinner","type":"script","item-type":"function","params":[],"sync":false,"content":"var loader = document.getElementsByTagName('activity-loader')[0];\nloader.hide();"},{"name":"setFailReason","type":"script","item-type":"function","params":[{"name":"reason","required":true}],"content":"var currentJob = mdm.store.data__.currentJob;\ncurrentJob.Reason = reason;\n\ndocument.querySelector('a#btnSelectReason').textContent = reason;\n\nvar popup = document.getElementById('popFailReason');\npopup.togglePopup();"},{"name":"On-Load Event","type":"event","item-type":"onload","actions":[{"event":"onload","type":"inline-function","data":{"code":"console.log('App started...');\nwindow.commsManager = new CommsManager();"},"_auto_id_":"83dd7be5-3f08-496a-bfbd-7e86a21e1889"}]}],"components":[{"content":"InVzZSBzdHJpY3QiOwoKdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCnZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KF94LCBfeDIsIF94MykgeyB2YXIgX2FnYWluID0gdHJ1ZTsgX2Z1bmN0aW9uOiB3aGlsZSAoX2FnYWluKSB7IHZhciBvYmplY3QgPSBfeCwgcHJvcGVydHkgPSBfeDIsIHJlY2VpdmVyID0gX3gzOyBkZXNjID0gcGFyZW50ID0gZ2V0dGVyID0gdW5kZWZpbmVkOyBfYWdhaW4gPSBmYWxzZTsgaWYgKG9iamVjdCA9PT0gbnVsbCkgb2JqZWN0ID0gRnVuY3Rpb24ucHJvdG90eXBlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IF94ID0gcGFyZW50OyBfeDIgPSBwcm9wZXJ0eTsgX3gzID0gcmVjZWl2ZXI7IF9hZ2FpbiA9IHRydWU7IGNvbnRpbnVlIF9mdW5jdGlvbjsgfSB9IGVsc2UgaWYgKCJ2YWx1ZSIgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTsKCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0KCnZhciBDVENvbnRleHRNZW51ID0gKGZ1bmN0aW9uIChfSFRNTEVsZW1lbnQpIHsKICAgIF9pbmhlcml0cyhDVENvbnRleHRNZW51LCBfSFRNTEVsZW1lbnQpOwoKICAgIGZ1bmN0aW9uIENUQ29udGV4dE1lbnUoKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIF9DVENvbnRleHRNZW51KTsKCiAgICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoX0NUQ29udGV4dE1lbnUucHJvdG90eXBlKSwgImNvbnN0cnVjdG9yIiwgdGhpcykuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0KCiAgICBfY3JlYXRlQ2xhc3MoQ1RDb250ZXh0TWVudSwgW3sKICAgICAgICBrZXk6ICJhdHRhY2hlZENhbGxiYWNrIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gYXR0YWNoZWRDYWxsYmFjaygpIHsKICAgICAgICAgICAgdGhpcy5wb3B1cCA9IHRoaXMuZ2V0QXR0cmlidXRlKCdwb3B1cCcpOwogICAgICAgICAgICB0aGlzLm1pbldpZHRoID0gdGhpcy5nZXRBdHRyaWJ1dGUoJ21pbndpZHRoJykgPT09ICdudWxsJyA/IDAgOiBwYXJzZUludCh0aGlzLmdldEF0dHJpYnV0ZSgnbWlud2lkdGgnKSk7CiAgICAgICAgICAgIHRoaXMub3JpZW50YXRpb24gPSB0aGlzLmdldEF0dHJpYnV0ZSgnb3JpZW50YXRpb24nKTsKCiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9ICdjb250ZXh0TWVudUJHJzsKICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogICAgICAgICAgICB2YXIgbWVudSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICBtZW51LmNsYXNzTmFtZSA9ICdjb250ZXh0TWVudSc7CgogICAgICAgICAgICB3aGlsZSAodGhpcy5jaGlsZE5vZGVzLmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgICAgICAgbWVudS5hcHBlbmRDaGlsZCh0aGlzLmNoaWxkTm9kZXNbMF0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy53aW5kb3dTaXplQ2hhbmdlKTsKCiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChtZW51KTsKICAgICAgICAgICAgdGhpcy5hcHBlbmRDaGlsZChjb250YWluZXIpOwogICAgICAgICAgICB0aGlzLm9wZW5lZCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gVG9nZ2xlcyB0aGUgbWVudSBvcGVuZWQgYW5kIGNsb3NlZCBiYXNlZCBvbiB0aGUgdmFsdWUKICAgICAgICAvLyBvZiB0aGUgdGhpcy5vcGVuZWQgcHJvcGVydHkgKGluaXRpYWxseSBzZXQgdG8gZmFsc2UpCiAgICB9LCB7CiAgICAgICAga2V5OiAidG9nZ2xlTWVudSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRvZ2dsZU1lbnUoKSB7CiAgICAgICAgICAgIHZhciBjb250ZXh0TWVudSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2NvbnRleHRNZW51QkcnKVswXTsKCiAgICAgICAgICAgIGlmICghdGhpcy5vcGVuZWQpIHsKICAgICAgICAgICAgICAgIC8vIFBPUFVQIExPR0lDCiAgICAgICAgICAgICAgICBpZiAodGhpcy5wb3B1cCA9PT0gInRydWUiKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRDb250ZXh0TWVudUlubmVyKHRoaXMpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMub3BlbmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jbG9zZU1lbnUsIHRydWUpOwogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuc3R5bGUuZGlzcGxheSA9ICdpbml0aWFsJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMub3BlbmVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuY2xvc2VNZW51KTsKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFRoZSBjbG9zZSBmdW5jdGlvbiB3ZSBiaW5kIG91ciBjbGljayBldmVudCB0by4gVGhpcwogICAgICAgIC8vIGhhbmRsZXMga2VlcGluZyB0aGUgJ3RoaXMnIGtleXdvcmQgaW4gc2NvcGUKICAgIH0sIHsKICAgICAgICBrZXk6ICJjbG9zZU1lbnUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjbG9zZU1lbnUoZSkgewogICAgICAgICAgICB2YXIgY29udGV4dE1lbnUgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnY3QtY29udGV4dC1tZW51JylbMF07CiAgICAgICAgICAgIGNvbnRleHRNZW51LnRvZ2dsZU1lbnUoKTsKICAgICAgICB9CiAgICB9LCB7CiAgICAgICAga2V5OiAic2V0Q29udGV4dE1lbnVJbm5lciIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldENvbnRleHRNZW51SW5uZXIoY29udGV4dE1lbnUpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzICE9PSBDVENvbnRleHRNZW51KSB7CiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSBjb250ZXh0TWVudTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNvbnRleHRNZW51SW5uZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdjb250ZXh0TWVudScpWzBdOwogICAgICAgICAgICB2YXIgcG9zID0gX3RoaXMuZ2VuZXJhdGVQb3NpdGlvbk9uUGFnZSgpOwogICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdQT1BVUCBQb3NpdGlvbnM6ICcsIHBvcy50b1N0cmluZygpKTsKICAgICAgICAgICAgY29udGV4dE1lbnVJbm5lci5zdHlsZS50b3AgPSBwb3MudG9wICsgJ3B4JzsKCiAgICAgICAgICAgIGlmIChfdGhpcy5vcmllbnRhdGlvbiA9PSAncmlnaHQnICYmIF90aGlzLm1pbldpZHRoICE9PSAwKSB7CiAgICAgICAgICAgICAgICB2YXIgb2Zmc2V0ID0gcG9zLmxlZnQgLSAoX3RoaXMubWluV2lkdGggLSBwb3Mud2lkdGgpOwogICAgICAgICAgICAgICAgY29udGV4dE1lbnVJbm5lci5zdHlsZS5sZWZ0ID0gb2Zmc2V0ICsgJ3B4JzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51SW5uZXIuc3R5bGUubGVmdCA9IHBvcy5sZWZ0ICsgJ3B4JzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKF90aGlzLm1pbldpZHRoICE9PSAwICYmIHBvcy53aWR0aCA8IF90aGlzLm1pbldpZHRoKSB7CiAgICAgICAgICAgICAgICBjb250ZXh0TWVudUlubmVyLnN0eWxlLndpZHRoID0gX3RoaXMubWluV2lkdGggKyAncHgnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29udGV4dE1lbnVJbm5lci5zdHlsZS53aWR0aCA9IHBvcy53aWR0aCArICdweCc7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LCB7CiAgICAgICAga2V5OiAiZ2VuZXJhdGVQb3NpdGlvbk9uUGFnZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdlbmVyYXRlUG9zaXRpb25PblBhZ2UoKSB7CiAgICAgICAgICAgIC8vIFRFTVAKICAgICAgICAgICAgdmFyIGNhbGxpbmdCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdhI2J1dHRvbl8yNycpOwoKICAgICAgICAgICAgdmFyIGNhbGxpbmdCdG5Qb3MgPSBjYWxsaW5nQnRuLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgICAgICB2YXIgcGFkVG9wID0gJChjYWxsaW5nQnRuKS5jc3MoJ3BhZGRpbmctdG9wJyk7CiAgICAgICAgICAgIHZhciBwYWRCb3QgPSAkKGNhbGxpbmdCdG4pLmNzcygncGFkZGluZy1ib3R0b20nKTsKICAgICAgICAgICAgdmFyIGJvcmRlcldpZHRoID0gJChjYWxsaW5nQnRuKS5jc3MoJ2JvcmRlci13aWR0aCcpOwoKICAgICAgICAgICAgdmFyIHBhZFRvcCA9IHBhcnNlSW50KHBhZFRvcC5zdWJzdHJpbmcoMCwgcGFkVG9wLmxlbmd0aCAtIDIpKTsKICAgICAgICAgICAgdmFyIHBhZEJvdCA9IHBhcnNlSW50KHBhZEJvdC5zdWJzdHJpbmcoMCwgcGFkQm90Lmxlbmd0aCAtIDIpKTsKICAgICAgICAgICAgdmFyIGJvcmRlcldpZHRoID0gcGFyc2VJbnQoYm9yZGVyV2lkdGguc3Vic3RyaW5nKDAsIGJvcmRlcldpZHRoLmxlbmd0aCAtIDIpKTsKCiAgICAgICAgICAgIHZhciB0b3AgPSBjYWxsaW5nQnRuUG9zLnRvcCArIHBhZFRvcCArIHBhZEJvdCArIGJvcmRlcldpZHRoOwogICAgICAgICAgICB2YXIgbGVmdCA9IGNhbGxpbmdCdG5Qb3MubGVmdDsKICAgICAgICAgICAgdmFyIHJpZ2h0ID0gY2FsbGluZ0J0blBvcy5yaWdodDsKICAgICAgICAgICAgdmFyIHdpZHRoID0gY2FsbGluZ0J0blBvcy53aWR0aDsKCiAgICAgICAgICAgIHZhciByZXMgPSB7CiAgICAgICAgICAgICAgICB0b3A6IHRvcCwKICAgICAgICAgICAgICAgIGxlZnQ6IGxlZnQsCiAgICAgICAgICAgICAgICByaWdodDogcmlnaHQsCiAgICAgICAgICAgICAgICB3aWR0aDogd2lkdGgKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfQogICAgfSwgewogICAgICAgIGtleTogIndpbmRvd1NpemVDaGFuZ2UiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiB3aW5kb3dTaXplQ2hhbmdlKCkgewogICAgICAgICAgICB2YXIgY29udGV4dE1lbnUgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnY3QtY29udGV4dC1tZW51JylbMF07CgogICAgICAgICAgICBpZiAoY29udGV4dE1lbnUub3BlbmVkKSB7CiAgICAgICAgICAgICAgICBpZiAoY29udGV4dE1lbnUucG9wdXAgPT09ICJ0cnVlIikgewogICAgICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LnNldENvbnRleHRNZW51SW5uZXIoY29udGV4dE1lbnUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfV0pOwoKICAgIHZhciBfQ1RDb250ZXh0TWVudSA9IENUQ29udGV4dE1lbnU7CiAgICBDVENvbnRleHRNZW51ID0gV2ViQ29tcG9uZW50cy5hbm5vdGF0ZSh7CiAgICAgICAgImF0dHJpYnV0ZXMiOiB7CiAgICAgICAgICAgICJwcm9wZXJ0aWVzIjogewogICAgICAgICAgICAgICAgIlBvcHVwIjogewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImJvb2xlYW4iCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIk1pbldpZHRoIjogewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImludGVnZXIiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIk9yaWVudGF0aW9uIjogewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogInN0cmluZyIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgInJlcXVpcmVkIjogWyJQb3B1cCJdCiAgICAgICAgfSwKICAgICAgICAiY29udGFpbmVyIjogdHJ1ZQogICAgfSkoQ1RDb250ZXh0TWVudSkgfHwgQ1RDb250ZXh0TWVudTsKICAgIHJldHVybiBDVENvbnRleHRNZW51Owp9KShIVE1MRWxlbWVudCk7Cgpkb2N1bWVudC5yZWdpc3RlckVsZW1lbnQoJ2N0LWNvbnRleHQtbWVudScsIENUQ29udGV4dE1lbnUpOw==","type":"web-component-es2015","element":"ct-context-menu","usage":"<ct-context-menu></ct-context-menu>","name":"CTContextMenu"},{"content":"InVzZSBzdHJpY3QiOwoKdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCnZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KF94LCBfeDIsIF94MykgeyB2YXIgX2FnYWluID0gdHJ1ZTsgX2Z1bmN0aW9uOiB3aGlsZSAoX2FnYWluKSB7IHZhciBvYmplY3QgPSBfeCwgcHJvcGVydHkgPSBfeDIsIHJlY2VpdmVyID0gX3gzOyBkZXNjID0gcGFyZW50ID0gZ2V0dGVyID0gdW5kZWZpbmVkOyBfYWdhaW4gPSBmYWxzZTsgaWYgKG9iamVjdCA9PT0gbnVsbCkgb2JqZWN0ID0gRnVuY3Rpb24ucHJvdG90eXBlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IF94ID0gcGFyZW50OyBfeDIgPSBwcm9wZXJ0eTsgX3gzID0gcmVjZWl2ZXI7IF9hZ2FpbiA9IHRydWU7IGNvbnRpbnVlIF9mdW5jdGlvbjsgfSB9IGVsc2UgaWYgKCJ2YWx1ZSIgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTsKCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0KCnZhciBDVFBvcHVwQm94ID0gKGZ1bmN0aW9uIChfSFRNTEVsZW1lbnQpIHsKCV9pbmhlcml0cyhDVFBvcHVwQm94LCBfSFRNTEVsZW1lbnQpOwoKCWZ1bmN0aW9uIENUUG9wdXBCb3goKSB7CgkJX2NsYXNzQ2FsbENoZWNrKHRoaXMsIF9DVFBvcHVwQm94KTsKCgkJX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoX0NUUG9wdXBCb3gucHJvdG90eXBlKSwgImNvbnN0cnVjdG9yIiwgdGhpcykuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCX0KCglfY3JlYXRlQ2xhc3MoQ1RQb3B1cEJveCwgW3sKCQlrZXk6ICJhdHRhY2hlZENhbGxiYWNrIiwKCQl2YWx1ZTogZnVuY3Rpb24gYXR0YWNoZWRDYWxsYmFjaygpIHsKCQkJdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQljb250YWluZXIuY2xhc3NOYW1lID0gJ3BvcHVwQkcnOwoJCQljb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCgkJCXZhciBwb3B1cEJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQlwb3B1cEJveC5jbGFzc05hbWUgPSAncG9wdXBCb3gnOwoKCQkJd2hpbGUgKHRoaXMuY2hpbGROb2Rlcy5sZW5ndGggIT09IDApIHsKCQkJCXBvcHVwQm94LmFwcGVuZENoaWxkKHRoaXMuY2hpbGROb2Rlc1swXSk7CgkJCX0KCgkJCWNvbnRhaW5lci5hcHBlbmRDaGlsZChwb3B1cEJveCk7CgkJCXRoaXMuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTsKCQkJdGhpcy5vcGVuZWQgPSBmYWxzZTsKCQkJdGhpcy5pZCA9IHRoaXMuZ2V0QXR0cmlidXRlKCJpZCIpOwoJCX0KCgkJLy8gVG9nZ2xlcyB0aGUgbWVudSBvcGVuZWQgYW5kIGNsb3NlZCBiYXNlZCBvbiB0aGUgdmFsdWUKCQkvLyBvZiB0aGUgdGhpcy5vcGVuZWQgcHJvcGVydHkgKGluaXRpYWxseSBzZXQgdG8gZmFsc2UpCgl9LCB7CgkJa2V5OiAidG9nZ2xlUG9wdXAiLAoJCXZhbHVlOiBmdW5jdGlvbiB0b2dnbGVQb3B1cCgpIHsKCQkJdmFyIGNvbnRleHRNZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignY3QtcG9wdXAtYm94IycgKyB0aGlzLmlkICsgJyA+IC5wb3B1cEJHJyk7CgoJCQlpZiAoIXRoaXMub3BlbmVkKSB7CgkJCQl0aGlzLm9wZW5lZCA9IHRydWU7CgkJCQkvL2NvbnRleHRNZW51LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jbG9zZU1lbnUsIHRydWUpOwoJCQkJY29udGV4dE1lbnUuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKCQkJfSBlbHNlIHsKCQkJCXRoaXMub3BlbmVkID0gZmFsc2U7CgkJCQkvL2NvbnRleHRNZW51LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jbG9zZU1lbnUpOwoJCQkJY29udGV4dE1lbnUuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCQkJfQoJCX0KCX1dKTsKCgl2YXIgX0NUUG9wdXBCb3ggPSBDVFBvcHVwQm94OwoJQ1RQb3B1cEJveCA9IFdlYkNvbXBvbmVudHMuYW5ub3RhdGUoewoJCSJhdHRyaWJ1dGVzIjogewoJCQkicHJvcGVydGllcyI6IHsKCQkJCSJpZCI6IHsKCQkJCQkidHlwZSI6ICJzdHJpbmciCgkJCQl9CgkJCX0sCgkJCSJyZXF1aXJlZCI6IFsiaWQiXQoJCX0sCgkJImNvbnRhaW5lciI6IHRydWUKCX0pKENUUG9wdXBCb3gpIHx8IENUUG9wdXBCb3g7CglyZXR1cm4gQ1RQb3B1cEJveDsKfSkoSFRNTEVsZW1lbnQpOwoKZG9jdW1lbnQucmVnaXN0ZXJFbGVtZW50KCdjdC1wb3B1cC1ib3gnLCBDVFBvcHVwQm94KTs=","type":"web-component-es2015","element":"ct-popup-box","usage":"<ct-popup-box></ct-popup-box>","name":"CTPopupBox"},{"content":"InVzZSBzdHJpY3QiOwoKdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCnZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KF94LCBfeDIsIF94MykgeyB2YXIgX2FnYWluID0gdHJ1ZTsgX2Z1bmN0aW9uOiB3aGlsZSAoX2FnYWluKSB7IHZhciBvYmplY3QgPSBfeCwgcHJvcGVydHkgPSBfeDIsIHJlY2VpdmVyID0gX3gzOyBkZXNjID0gcGFyZW50ID0gZ2V0dGVyID0gdW5kZWZpbmVkOyBfYWdhaW4gPSBmYWxzZTsgaWYgKG9iamVjdCA9PT0gbnVsbCkgb2JqZWN0ID0gRnVuY3Rpb24ucHJvdG90eXBlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IF94ID0gcGFyZW50OyBfeDIgPSBwcm9wZXJ0eTsgX3gzID0gcmVjZWl2ZXI7IF9hZ2FpbiA9IHRydWU7IGNvbnRpbnVlIF9mdW5jdGlvbjsgfSB9IGVsc2UgaWYgKCJ2YWx1ZSIgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTsKCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0KCnZhciBDVEFjdGl2aXR5TG9hZGVyID0gKGZ1bmN0aW9uIChfSFRNTEVsZW1lbnQpIHsKICAgIF9pbmhlcml0cyhDVEFjdGl2aXR5TG9hZGVyLCBfSFRNTEVsZW1lbnQpOwoKICAgIGZ1bmN0aW9uIENUQWN0aXZpdHlMb2FkZXIoKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIF9DVEFjdGl2aXR5TG9hZGVyKTsKCiAgICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoX0NUQWN0aXZpdHlMb2FkZXIucHJvdG90eXBlKSwgImNvbnN0cnVjdG9yIiwgdGhpcykuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0KCiAgICBfY3JlYXRlQ2xhc3MoQ1RBY3Rpdml0eUxvYWRlciwgW3sKICAgICAgICBrZXk6ICJhdHRhY2hlZENhbGxiYWNrIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gYXR0YWNoZWRDYWxsYmFjaygpIHsKICAgICAgICAgICAgdGhpcy5jbGFzc05hbWUgPSAnaGlkZGVuJzsKICAgICAgICAgICAgdmFyIGljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpJyk7CiAgICAgICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQoaWNvbik7CiAgICAgICAgfQogICAgfSwgewogICAgICAgIGtleTogInNob3ciLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzaG93KCkgewogICAgICAgICAgICB2YXIgbG9hZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2FjdGl2aXR5LWxvYWRlcicpWzBdOwogICAgICAgICAgICBsb2FkZXIuY2xhc3NOYW1lID0gJyc7CiAgICAgICAgfQogICAgfSwgewogICAgICAgIGtleTogImhpZGUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBoaWRlKCkgewogICAgICAgICAgICB2YXIgbG9hZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2FjdGl2aXR5LWxvYWRlcicpWzBdOwogICAgICAgICAgICBsb2FkZXIuY2xhc3NOYW1lID0gJ2hpZGRlbic7CiAgICAgICAgfQogICAgfV0pOwoKICAgIHZhciBfQ1RBY3Rpdml0eUxvYWRlciA9IENUQWN0aXZpdHlMb2FkZXI7CiAgICBDVEFjdGl2aXR5TG9hZGVyID0gV2ViQ29tcG9uZW50cy5hbm5vdGF0ZSh7CiAgICAgICAgImF0dHJpYnV0ZXMiOiB7CiAgICAgICAgICAgICJwcm9wZXJ0aWVzIjoge30KICAgICAgICB9LAogICAgICAgICJjb250YWluZXIiOiBmYWxzZQogICAgfSkoQ1RBY3Rpdml0eUxvYWRlcikgfHwgQ1RBY3Rpdml0eUxvYWRlcjsKICAgIHJldHVybiBDVEFjdGl2aXR5TG9hZGVyOwp9KShIVE1MRWxlbWVudCk7Cgpkb2N1bWVudC5yZWdpc3RlckVsZW1lbnQoJ2FjdGl2aXR5LWxvYWRlcicsIENUQWN0aXZpdHlMb2FkZXIpOw==","type":"web-component-es2015","element":"activity-loader","usage":"<activity-loader></activity-loader>","name":"ActivityLoader"}],"translation":{"default":"en_GB"},"metadata":{},"splashdata":{},"splash":"default","workflows":[],"icondata":"Bulk Uplift Icon.png"}